<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Raanvi Client Dashboard - Binary Tree</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="assets/style.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/Binary.css">
 
</head>
<body> 
  <!-- Topbar -->
  <nav class="topbar text-white flex justify-between items-center">
    <div class="flex items-center space-x-4">
      <i class="fas fa-bars sidebar-toggle hidden md:block text-white" id="sidebar-toggle"></i>
      <i class="fas fa-bars menu-toggle block md:hidden text-white" id="menu-toggle"></i>    
      <!-- Increased scale to 150% -->
      <img src="images/logo.png" alt="Satiys Logo" class="w-16 h-16 sm:w-20 sm:h-20 md:w-24 md:h-24 object-contain transform scale-150">    
      <span style="font-family: Georgia, serif; color: #0A1A2F; text-shadow: 1px 1px 2px #FFD700, 0 0 5px #FFD700; font-size: 1.6rem; font-weight: bold; letter-spacing: 2px;">
        SATIYS
      </span>
    </div>
    <div class="flex items-center relative">
      <i class="fas fa-user-circle admin-icon" id="admin-icon"></i>
      <div class="admin-dropdown" id="admin-dropdown">
        <a href="profile.html" class="dropdown-item">My Profile</a>
        <a href="change-password.html" class="dropdown-item">Change Password</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <i class="fas fa-times sidebar-expand" id="sidebar-expand"></i>
      <h3></h3>
      <a href="index.html"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a>
      <div class="sidebar-item">
        <a href="#" id="my-account-toggle">
          <i class="fas fa-user"></i>
          <span>My Account</span>
          <i class="fas fa-chevron-down dropdown-icon"></i>
        </a>
        <div class="submenu" id="my-account-submenu">
          <a href="profile-details.html"><i class="fas fa-user-edit"></i> <span>Update-Profile Details</span></a>
          <a href="kyc-document.html"><i class="fas fa-file-upload"></i> <span>Upload KYC Document</span></a>
          <a href="change-password.html"><i class="fas fa-lock"></i> <span>Change Password</span></a>
          <a href="id-card.html"><i class="fas fa-id-card"></i> <span>ID Card</span></a>
        </div>
      </div>
      <div class="sidebar-item">
        <a href="#" id="my-team-toggle">
          <i class="fas fa-users"></i>
          <span>My Team</span>
          <i class="fas fa-chevron-down dropdown-icon"></i>
        </a>
        <div class="submenu" id="my-team-submenu">
          <a href="binary-tree.html"><i class="fas fa-sitemap"></i> <span>Binary Tree</span></a>
          <a href="my-downline.html" class="active"><i class="fas fa-user-friends"></i> <span>My Downline</span></a>
          <a href="my-referral.html"><i class="fas fa-user-plus"></i> <span>My Referral</span></a>
          <a href="binary-carry-forward.html"><i class="fas fa-exchange-alt"></i> <span>Binary Carry Forward</span></a>
        </div>
      </div>
      <div class="sidebar-item">
        <a href="#" id="earning-history-toggle">
          <i class="fas fa-money-check-alt"></i>
          <span>Earning History</span>
          <i class="fas fa-chevron-down dropdown-icon"></i>
        </a>
        <div class="submenu" id="earning-history-submenu">
          <a href="referral-bonus.html"><i class="fas fa-gift"></i> <span>Referral Bonus</span></a>
          <a href="leadership-bonus.html"><i class="fas fa-trophy"></i> <span>Leadership Bonus</span></a>
          <a href="direct-repurchase.html"><i class="fas fa-shopping-cart"></i> <span>Direct Repurchase Income</span></a>
          <a href="repurchase-share.html"><i class="fas fa-coins"></i> <span>Repurchase Share Income</span></a>

          <a href="rank-reward.html"><i class="fas fa-medal"></i> <span>Rank and Reward</span></a>
         
      </div>
      </div>
      <div class="sidebar-item">
        <a href="#" id="topup-fund-toggle">
          <i class="fas fa-wallet"></i>
          <span>Product & Payment</span>
          <i class="fas fa-chevron-down dropdown-icon"></i>
        </a>
        <div class="submenu" id="topup-fund-submenu">
          <a href="transaction-details.html" ><i class="fas fa-receipt"></i> <span>Transaction Details</span></a>
          <a href="product-details.html"><i class="fas fa-shopping-bag"></i> <span>Order Product</span></a>
          <a href="repurchase.html"><i class="fas fa-shopping-cart"></i> <span>Repurchase</span></a>
        </div>
      </div>
      <a href="customer.html"><i class="fas fa-users-cog"></i> <span>Customer Details</span></a>
      <a href="billing.html"><i class="fas fa-file-invoice-dollar"></i> <span>Billing Management</span></a>
      <a href="stock.html"><i class="fas fa-boxes"></i> <span>Stock Management</span></a>
      <a href="turnover.html"><i class="fas fa-chart-line"></i> <span>Turnover</span></a>
      <a href="withdrawal.html"><i class="fas fa-money-bill"></i> <span>Withdraw</span></a>
      <a href="wallet.html"><i class="fas fa-wallet"></i> <span>Savings Wallet</span></a>
      
      <a href="#" id="sidebar-sign-out"><i class="fas fa-sign-out-alt"></i> <span>Sign Out</span></a>
    </div>

   <!-- Tree Section -->
   <div class="main-content">
    <div class="section">
      <h2 class="text-2xl font-bold text-[#f4c430] mb-4">Tree View</h2>
      <div class="table-section">
        <div class="tree-tabs">
          <button class="tree-tab active" data-tree="binary">Binary Tree</button>
          <button class="tree-tab" data-tree="repurchase">Repurchase Tree</button>
        </div>
        <!-- Binary Tree Content -->
        <div class="tree-content binary-tree-content active">
          <h4>Binary Tree Data</h4>
          <div class="search-bar">
            <input type="text" id="binary-search-id" placeholder="Enter ID (e.g., RI001)">
            <button onclick="searchNode('binary')">Search</button>
          </div>
          <div class="binary-tree-container">
            <svg class="binary-tree-svg"></svg>
          </div>
          <div class="table-container">
            <h4>Binary Tree Details</h4>
            <div class="table-responsive">
              <table class="table table-bordered table-dark" id="binary-table">
                <thead>
                  <tr>
                    <th>User ID</th>
                    <th>Name</th>
                    <th>Qualified Date</th>
                    <th>BV Points</th>
                    <th>KYC Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr data-id="RI001">
                    <td>RI001</td>
                    <td>Varun</td>
                    <td>Jan 10, 2025</td>
                    <td>0</td>
                    <td>Verified</td>
                  </tr>
                  <tr data-id="RI002">
                    <td>RI002</td>
                    <td>Kiran</td>
                    <td>Jan 12, 2025</td>
                    <td>100</td>
                    <td>Verified</td>
                  </tr>
                  <tr data-id="RI003">
                    <td>RI003</td>
                    <td>Johnson</td>
                    <td>Jan 15, 2025</td>
                    <td>0</td>
                    <td>Pending</td>
                  </tr>
                  <tr data-id="RI004">
                    <td>RI004</td>
                    <td>Emily</td>
                    <td>Jan 20, 2025</td>
                    <td>0</td>
                    <td>Pending</td>
                  </tr>
                  <tr data-id="RI005">
                    <td>RI005</td>
                    <td>David</td>
                    <td>Jan 22, 2025</td>
                    <td>0</td>
                    <td>Verified</td>
                  </tr>
                  <tr data-id="RI006">
                    <td>RI006</td>
                    <td>Sarah</td>
                    <td>Jan 25, 2025</td>
                    <td>0</td>
                    <td>Pending</td>
                  </tr>
                  <tr data-id="RI007">
                    <td>RI007</td>
                    <td>Michael</td>
                    <td>Jan 28, 2025</td>
                    <td>0</td>
                    <td>Verified</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <!-- Repurchase Tree Content -->
        <div class="tree-content repurchase-tree-content">
          <h4>Repurchase Tree Data</h4>
          <div class="search-bar">
            <input type="text" id="repurchase-search-id" placeholder="Enter ID (e.g., RP001)" disabled>
            <button disabled>Search</button>
          </div>
          <div class="repurchase-tree-container">
            <svg class="repurchase-tree-svg"></svg>
          </div>
          <div class="table-container" id="repurchase-table-container">
            <h4>Repurchase Tree Details</h4>
            <div class="table-responsive">
              <table class="table table-bordered table-dark">
                <thead>
                  <tr>
                    <th>User ID</th>
                    <th>Name</th>
                    <th>Repurchase Date</th>
                    <th>Amount</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>RP001</td>
                    <td>Anita</td>
                    <td>Feb 01, 2025</td>
                    <td>â‚¹5000</td>
                    <td>Completed</td>
                  </tr>
                  <tr>
                    <td>RP002</td>
                    <td>Rajesh</td>
                    <td>Feb 03, 2025</td>
                    <td>â‚¹3000</td>
                    <td>Pending</td>
                  </tr>
                  <tr>
                    <td>RP003</td>
                    <td>Priya</td>
                    <td>Feb 05, 2025</td>
                    <td>â‚¹4000</td>
                    <td>Completed</td>
                  </tr>
                  <tr>
                    <td>RP004</td>
                    <td>Vikram</td>
                    <td>Feb 07, 2025</td>
                    <td>â‚¹2500</td>
                    <td>Pending</td>
                  </tr>
                  <tr>
                    <td>RP005</td>
                    <td>Neha</td>
                    <td>Feb 09, 2025</td>
                    <td>â‚¹3500</td>
                    <td>Completed</td>
                  </tr>
                  <tr>
                    <td>RP006</td>
                    <td>Arjun</td>
                    <td>Feb 11, 2025</td>
                    <td>â‚¹2000</td>
                    <td>Pending</td>
                  </tr>
                  <tr>
                    <td>RP007</td>
                    <td>Sonia</td>
                    <td>Feb 13, 2025</td>
                    <td>â‚¹4500</td>
                    <td>Completed</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer class="main-footer">
      @2025 Satiys - Developed By Bloom It Solutions
    </footer>
  </div>
  </div>

   <!-- Node Data Container for Small Screens -->
   <div class="node-data-container" id="node-data-container">
    <span class="close-btn" onclick="closeNodeData()">âœ•</span>
    <div id="node-data-content"></div>
  </div>

  <!-- Tree Data in HTML Format -->
  <div id="tree-data" style="display:none;">
    <div data-id="RI001" data-name="Name: Varun" data-email="E-Mail: varun@gmail.com" 
         data-mobile="Number: 9876543210" data-cfp="0RV" data-level="0" 
         data-x="0" data-y="50" data-left="RI002" data-right="RI003"></div>
    <div data-id="RI002" data-name="Name: Kiran" data-email="E-Mail: kiran@gmail.com" 
         data-mobile="Number: 9276543232" data-cfp="100RV" data-level="1" 
         data-x="-200" data-y="150" data-left="RI004" data-right="RI005"></div>
    <div data-id="RI003" data-name="Name: Johnson" data-email="E-Mail: john.j@gmail.com" 
         data-mobile="Number: 8876543210" data-cfp="0RV" data-level="1" 
         data-x="200" data-y="150" data-left="RI006" data-right="RI007"></div>
    <div data-id="RI004" data-name="Name: Emily" data-email="E-Mail: emily.b@gmail.com" 
         data-mobile="Number: 8736543210" data-cfp="0RV" data-level="2" 
         data-x="-300" data-y="250" data-left="" data-right=""></div>
    <div data-id="RI005" data-name="Name: David" data-email="E-Mail: david.w@gmail.com" 
         data-mobile="Number: 6856543210" data-cfp="0RV" data-level="2" 
         data-x="-100" data-y="250" data-left="" data-right=""></div>
    <div data-id="RI006" data-name="Name: Sarah" data-email="E-Mail: sarah.k@gmail.com" 
         data-mobile="Number: 9123456789" data-cfp="0RV" data-level="2" 
         data-x="100" data-y="250" data-left="" data-right=""></div>
    <div data-id="RI007" data-name="Name: Michael" data-email="E-Mail: michael.l@gmail.com" 
         data-mobile="Number: 9988776655" data-cfp="0RV" data-level="2" 
         data-x="300" data-y="250" data-left="" data-right=""></div>
  </div>

  <!-- Repurchase Tree Data in HTML Format -->
  <div id="repurchase-tree-data" style="display:none;">
    <div data-id="RP001" data-name="Name: Anita" data-email="E-Mail: anita@gmail.com" 
         data-mobile="Number: 9123456780" data-rv="100RV" data-level="0" data-x="0" data-y="50" 
         data-left1="RP002" data-left2="RP003" data-left3="RP004" 
         data-right1="RP005" data-right2="RP006" data-right3="RP007"></div>
    <div data-id="RP002" data-name="Name: Rajesh" data-email="E-Mail: rajesh@gmail.com" 
         data-mobile="Number: 9123456781" data-rv="50RV" data-level="1" data-x="-300" data-y="150"></div>
    <div data-id="RP003" data-name="Name: Priya" data-email="E-Mail: priya@gmail.com" 
         data-mobile="Number: 9123456782" data-rv="75RV" data-level="1" data-x="-200" data-y="150"></div>
    <div data-id="RP004" data-name="Name: Vikram" data-email="E-Mail: vikram@gmail.com" 
         data-mobile="Number: 9123456783" data-rv="25RV" data-level="1" data-x="-100" data-y="150"></div>
    <div data-id="RP005" data-name="Name: Neha" data-email="E-Mail: neha@gmail.com" 
         data-mobile="Number: 9123456784" data-rv="0RV" data-level="1" data-x="100" data-y="150"></div>
    <div data-id="RP006" data-name="Name: Arjun" data-email="E-Mail: arjun@gmail.com" 
         data-mobile="Number: 9123456785" data-rv="10RV" data-level="1" data-x="200" data-y="150"></div>
    <div data-id="RP007" data-name="Name: Sonia" data-email="E-Mail: sonia@gmail.com" 
         data-mobile="Number: 9123456786" data-rv="0RV" data-level="1" data-x="300" data-y="150"></div>
  </div>

  <!-- Visualization Configuration -->
  <div id="vis-config" style="display:none;" 
       data-node-radius-sm="16" data-node-radius-md="20" data-node-radius-lg="28"
       data-y-spacing-sm="80" data-y-spacing-md="100" data-y-spacing-lg="120"
       data-spacing-factor-sm="0.4" data-spacing-factor-md="0.6" data-spacing-factor-lg="1">
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // UI Controls
      const sidebarToggle = document.getElementById('sidebar-toggle');
      const sidebarExpand = document.getElementById('sidebar-expand');
      const sidebar = document.querySelector('.sidebar');
      const mainContent = document.querySelector('.main-content');
      const menuToggle = document.getElementById('menu-toggle');
      const adminIcon = document.getElementById('admin-icon');
      const adminDropdown = document.getElementById('admin-dropdown');
      const myTeamToggle = document.getElementById('my-team-toggle');
      const myTeamSubmenu = document.getElementById('my-team-submenu');
      const dropdownIcon = myTeamToggle.querySelector('.dropdown-icon');
      const treeTabs = document.querySelectorAll('.tree-tab');
      const treeContents = document.querySelectorAll('.tree-content');

      // Tree Visualization
      const binarySvg = document.querySelector('.binary-tree-svg');
      const binaryContainer = document.querySelector('.binary-tree-container');
      const repurchaseSvg = document.querySelector('.repurchase-tree-svg');
      const repurchaseContainer = document.querySelector('.repurchase-tree-container');
      const ns = 'http://www.w3.org/2000/svg';

      // Node data container for small screens
      const nodeDataContainer = document.getElementById('node-data-container');
      const nodeDataContent = document.getElementById('node-data-content');

      // Convert treeData to JavaScript array
      const binaryTreeData = Array.from(document.querySelectorAll('#tree-data div')).map(node => ({
        id: node.getAttribute('data-id'),
        name: node.getAttribute('data-name'),
        email: node.getAttribute('data-email'),
        mobile: node.getAttribute('data-mobile'),
        cfp: node.getAttribute('data-cfp'),
        level: parseInt(node.getAttribute('data-level')),
        x: parseInt(node.getAttribute('data-x')),
        y: parseInt(node.getAttribute('data-y')),
        left: node.getAttribute('data-left') || null,
        right: node.getAttribute('data-right') || null
      }));

      // Convert repurchaseTreeData to JavaScript array
      const repurchaseTreeData = Array.from(document.querySelectorAll('#repurchase-tree-data div')).map(node => ({
        id: node.getAttribute('data-id'),
        name: node.getAttribute('data-name'),
        email: node.getAttribute('data-email'),
        mobile: node.getAttribute('data-mobile'),
        rv: node.getAttribute('data-rv'),
        level: parseInt(node.getAttribute('data-level')),
        x: parseInt(node.getAttribute('data-x')),
        y: parseInt(node.getAttribute('data-y')),
        left1: node.getAttribute('data-left1') || null,
        left2: node.getAttribute('data-left2') || null,
        left3: node.getAttribute('data-left3') || null,
        right1: node.getAttribute('data-right1') || null,
        right2: node.getAttribute('data-right2') || null,
        right3: node.getAttribute('data-right3') || null
      }));

      // Sample repurchase table data
      const repurchaseTableData = {
        'RP001': { date: 'Feb 01, 2025', amount: 'â‚¹5000', status: 'Completed' },
        'RP002': { date: 'Feb 03, 2025', amount: 'â‚¹3000', status: 'Pending' },
        'RP003': { date: 'Feb 05, 2025', amount: 'â‚¹4000', status: 'Completed' },
        'RP004': { date: 'Feb 07, 2025', amount: 'â‚¹2500', status: 'Pending' },
        'RP005': { date: 'Feb 09, 2025', amount: 'â‚¹3500', status: 'Completed' },
        'RP006': { date: 'Feb 11, 2025', amount: 'â‚¹2000', status: 'Pending' },
        'RP007': { date: 'Feb 13, 2025', amount: 'â‚¹4500', status: 'Completed' }
      };

      // Get visualization config
      const visConfig = document.getElementById('vis-config');
      const config = {
        nodeRadius: {
          sm: parseInt(visConfig.getAttribute('data-node-radius-sm')),
          md: parseInt(visConfig.getAttribute('data-node-radius-md')),
          lg: parseInt(visConfig.getAttribute('data-node-radius-lg'))
        },
        ySpacing: {
          sm: parseInt(visConfig.getAttribute('data-y-spacing-sm')),
          md: parseInt(visConfig.getAttribute('data-y-spacing-md')),
          lg: parseInt(visConfig.getAttribute('data-y-spacing-lg'))
        },
        spacingFactor: {
          sm: parseFloat(visConfig.getAttribute('data-spacing-factor-sm')),
          md: parseFloat(visConfig.getAttribute('data-spacing-factor-md')),
          lg: parseFloat(visConfig.getAttribute('data-spacing-factor-lg'))
        }
      };

      // Function to display default repurchase table
      function displayDefaultRepurchaseTable() {
        const container = document.getElementById('repurchase-table-container');
        container.innerHTML = `
          <h4>Repurchase Tree Details</h4>
          <div class="table-responsive">
            <table class="table table-bordered table-dark">
              <thead>
                <tr>
                  <th>User ID</th>
                  <th>Name</th>
                  <th>Repurchase Date</th>
                  <th>Amount</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                ${Object.keys(repurchaseTableData).map(id => {
                  const node = repurchaseTreeData.find(n => n.id === id);
                  return `
                    <tr data-id="${id}">
                      <td>${id}</td>
                      <td>${node.name.split(': ')[1]}</td>
                      <td>${repurchaseTableData[id].date}</td>
                      <td>${repurchaseTableData[id].amount}</td>
                      <td>${repurchaseTableData[id].status}</td>
                    </tr>
                  `;
                }).join('')}
              </tbody>
            </table>
          </div>
        `;
      }

      // Function to display single node repurchase data
      function displayRepurchaseNodeData(nodeId) {
        const container = document.getElementById('repurchase-table-container');
        const node = repurchaseTreeData.find(n => n.id === nodeId);
        const tableData = repurchaseTableData[nodeId];
        if (node && tableData) {
          container.innerHTML = `
            <h4>Repurchase Tree Details</h4>
            <div class="table-responsive">
              <table class="table table-bordered table-dark">
                <thead>
                  <tr>
                    <th>User ID</th>
                    <th>Name</th>
                    <th>Repurchase Date</th>
                    <th>Amount</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr data-id="${nodeId}" class="table-row-highlighted">
                    <td>${node.id}</td>
                    <td>${node.name.split(': ')[1]}</td>
                    <td>${tableData.date}</td>
                    <td>${tableData.amount}</td>
                    <td>${tableData.status}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          `;
        }
      }

      function highlightTableRow(type, nodeId) {
        if (type === 'binary') {
          const table = document.getElementById('binary-table');
          const rows = table.querySelectorAll('tbody tr');
          rows.forEach(row => {
            row.classList.remove('table-row-highlighted');
            if (row.getAttribute('data-id') === nodeId) {
              row.classList.add('table-row-highlighted');
              row.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
          });
        }
      }

      // Function to show node data in the bottom container (small screens)
      function showNodeData(node, type) {
        const details = [
          node.name,
          node.email,
          type === 'binary' ? `CFP: ${node.cfp}` : `RV: ${node.rv}`,
          node.mobile
        ];
        nodeDataContent.innerHTML = details.map(detail => `<p>${detail}</p>`).join('');
        nodeDataContainer.style.display = 'block';
      }

      // Function to close the node data container
      window.closeNodeData = function() {
        nodeDataContainer.style.display = 'none';
        nodeDataContent.innerHTML = '';
      };

      function drawTree(type, highlightedId = null) {
        const svg = type === 'binary' ? binarySvg : repurchaseSvg;
        const container = type === 'binary' ? binaryContainer : repurchaseContainer;
        const treeData = type === 'binary' ? binaryTreeData : repurchaseTreeData;
        svg.innerHTML = '';

        const containerWidth = container.clientWidth;
        const screenWidth = window.innerWidth;

        const spacingFactor = screenWidth <= 480 ? config.spacingFactor.sm : 
                             screenWidth <= 768 ? config.spacingFactor.md : 
                             config.spacingFactor.lg;
        const nodeRadius = screenWidth <= 480 ? config.nodeRadius.sm : 
                           screenWidth <= 768 ? config.nodeRadius.md : 
                           config.nodeRadius.lg;
        const ySpacing = screenWidth <= 480 ? config.ySpacing.sm : 
                         screenWidth <= 768 ? config.ySpacing.md : 
                         config.ySpacing.lg;

        const offsetX = containerWidth / 2;

        const updatedTreeData = treeData.map(node => ({
          ...node,
          x: (node.x * spacingFactor) + offsetX,
          y: node.level * ySpacing + 50
        }));

        // Draw connections
        updatedTreeData.forEach(node => {
          const children = type === 'binary' 
            ? [node.left, node.right]
            : [node.left1, node.left2, node.left3, node.right1, node.right2, node.right3];
          
          children.forEach(childId => {
            if (childId) {
              const child = updatedTreeData.find(n => n.id === childId);
              if (child) {
                const path = document.createElementNS(ns, 'path');
                path.setAttribute('class', 'link');
                path.setAttribute('d', `M${node.x},${node.y + nodeRadius} L${child.x},${child.y - nodeRadius}`);
                svg.appendChild(path);
              }
            }
          });
        });

        // Draw nodes
        updatedTreeData.forEach(node => {
          const g = document.createElementNS(ns, 'g');
          g.setAttribute('class', `node ${node.id === highlightedId ? 'highlighted' : ''}`);
          g.setAttribute('data-id', node.id);

          const circle = document.createElementNS(ns, 'circle');
          circle.setAttribute('class', 'node-circle');
          circle.setAttribute('cx', node.x);
          circle.setAttribute('cy', node.y);
          circle.setAttribute('r', nodeRadius);
          g.appendChild(circle);

          const userIcon = document.createElementNS(ns, 'text');
          userIcon.setAttribute('class', 'node-icon');
          userIcon.setAttribute('x', node.x);
          userIcon.setAttribute('y', node.y);
          userIcon.setAttribute('text-anchor', 'middle');
          userIcon.textContent = 'ðŸ‘¤';
          g.appendChild(userIcon);

          const childIndicatorsGroup = document.createElementNS(ns, 'g');
          childIndicatorsGroup.setAttribute('class', 'child-indicators-group');
          childIndicatorsGroup.style.visibility = 'hidden';

          const children = type === 'binary' 
            ? [{ id: node.left, x: -1 }, { id: node.right, x: 1 }]
            : [
                { id: node.left1, x: -3 }, { id: node.left2, x: -2 }, { id: node.left3, x: -1 },
                { id: node.right1, x: 1 }, { id: node.right2, x: 2 }, { id: node.right3, x: 3 }
              ].filter(child => child.id);

          children.forEach(child => {
            const indicator = document.createElementNS(ns, 'text');
            indicator.setAttribute('class', 'child-indicator');
            indicator.setAttribute('x', node.x + (child.x * (nodeRadius + 10)));
            indicator.setAttribute('y', node.y + 5);
            indicator.setAttribute('text-anchor', 'middle');
            indicator.textContent = child.x < 0 ? 'â—„' : 'â–º';
            childIndicatorsGroup.appendChild(indicator);
          });

          g.appendChild(childIndicatorsGroup);

          const idText = document.createElementNS(ns, 'text');
          idText.setAttribute('class', 'node-id');
          idText.setAttribute('x', node.x);
          idText.setAttribute('y', type === 'repurchase' ? node.y - nodeRadius - 10 : node.y + nodeRadius + 10);
          idText.textContent = `${node.id} (${node.name.split(': ')[1]})`;
          g.appendChild(idText);

          const detailsGroup = document.createElementNS(ns, 'g');
          detailsGroup.setAttribute('class', 'node-details-group');
          detailsGroup.style.visibility = 'hidden';

          const details = [
            { label: node.name, offsetY: -25 },
            { label: node.email, offsetY: -10 },
            { label: type === 'binary' ? `CFP: ${node.cfp}` : `RV: ${node.rv}`, offsetY: 5 },
            { label: node.mobile, offsetY: 20 }
          ];

          details.forEach(detail => {
            const detailText = document.createElementNS(ns, 'text');
            detailText.setAttribute('class', 'node-details');
            detailText.setAttribute('x', node.x + nodeRadius + 10);
            detailText.setAttribute('y', node.y + detail.offsetY);
            detailText.textContent = detail.label;
            detailsGroup.appendChild(detailText);
          });

          g.appendChild(detailsGroup);
          svg.appendChild(g);
        });

        // Add hover and click events
        document.querySelectorAll('.node').forEach(node => {
          const detailsGroup = node.querySelector('.node-details-group');
          const childIndicatorsGroup = node.querySelector('.child-indicators-group');
          const nodeId = node.getAttribute('data-id');
          const nodeData = (type === 'binary' ? binaryTreeData : repurchaseTreeData).find(n => n.id === nodeId);

          // Determine if the screen is small
          const isSmallScreen = window.innerWidth <= 768;

          if (!isSmallScreen) {
            // Hover behavior for larger screens
            node.addEventListener('mouseover', () => {
              detailsGroup.style.visibility = 'visible';
              childIndicatorsGroup.style.visibility = 'visible';
            });
            node.addEventListener('mouseout', () => {
              detailsGroup.style.visibility = 'hidden';
              childIndicatorsGroup.style.visibility = 'hidden';
            });
          }

          // Click behavior for all screens
          node.addEventListener('click', () => {
            if (isSmallScreen) {
              // Show data in bottom container on small screens
              showNodeData(nodeData, type);
            }
            if (type === 'repurchase') {
              displayRepurchaseNodeData(nodeId);
            }
          });
        });

        if (highlightedId) {
          const highlightedNode = document.querySelector(`.node[data-id="${highlightedId}"]`);
          if (highlightedNode) {
            const circle = highlightedNode.querySelector('.node-circle');
            const cx = parseFloat(circle.getAttribute('cx'));
            const cy = parseFloat(circle.getAttribute('cy'));
            container.scrollTo({
              left: cx - container.clientWidth / 2,
              top: cy - container.clientHeight / 2,
              behavior: 'smooth'
            });
          }
        }
      }

      window.searchNode = function(type) {
        if (type === 'binary') {
          const searchInput = document.getElementById('binary-search-id').value.trim().toUpperCase();
          if (searchInput) {
            const node = binaryTreeData.find(n => n.id === searchInput);
            if (node) {
              drawTree('binary', searchInput);
              highlightTableRow('binary', searchInput);
            } else {
              alert('ID not found in binary tree.');
              drawTree('binary');
              highlightTableRow('binary', null);
            }
          } else {
            drawTree('binary');
            highlightTableRow('binary', null);
          }
        }
      };

      // Tab switching
      treeTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          treeTabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          treeContents.forEach(c => c.classList.remove('active'));
          document.querySelector(`.${tab.dataset.tree}-tree-content`).classList.add('active');
          drawTree(tab.dataset.tree);
          if (tab.dataset.tree === 'repurchase') {
            displayDefaultRepurchaseTable();
          } else {
            highlightTableRow('binary', null);
          }
          // Close node data container when switching tabs
          closeNodeData();
        });
      });

      // Search bar Enter key
      document.getElementById('binary-search-id').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          searchNode('binary');
        }
      });

      // Initial draw
      drawTree('binary');

      // Redraw on resize
      window.addEventListener('resize', () => {
        const activeTab = document.querySelector('.tree-tab.active');
        drawTree(activeTab.dataset.tree);
        // Close node data container on resize if screen size changes
        if (window.innerWidth > 768) {
          closeNodeData();
        }
      });

      // Sidebar toggle
      if (sidebarToggle && sidebarExpand && sidebar && mainContent) {
        sidebarToggle.addEventListener('click', () => {
          const isCollapsed = sidebar.classList.toggle('collapsed');
          mainContent.classList.toggle('collapsed');
          sidebarExpand.style.display = isCollapsed && window.innerWidth >= 769 ? 'block' : 'none';
          document.querySelectorAll('.submenu').forEach(submenu => submenu.classList.remove('active'));
          document.querySelectorAll('.dropdown-icon').forEach(icon => icon.classList.remove('active'));
        });
        sidebarExpand.addEventListener('click', () => {
          sidebar.classList.remove('collapsed');
          mainContent.classList.remove('collapsed');
          sidebarExpand.style.display = 'none';
        });
      }

      // Mobile menu
      if (menuToggle && sidebar) {
        menuToggle.addEventListener('click', () => {
          sidebar.classList.toggle('active');
        });
      }

      // Admin dropdown
      if (adminIcon && adminDropdown) {
        adminIcon.addEventListener('click', (e) => {
          e.stopPropagation();
          adminDropdown.classList.toggle('active');
        });
        document.addEventListener('click', (e) => {
          if (!adminIcon.contains(e.target) && !adminDropdown.contains(e.target)) {
            adminDropdown.classList.remove('active');
          }
        });
      }

      // My Team submenu
      if (myTeamToggle && myTeamSubmenu && dropdownIcon) {
        myTeamToggle.addEventListener('click', (e) => {
          e.preventDefault();
          myTeamSubmenu.classList.toggle('active');
          dropdownIcon.classList.toggle('active');
          document.querySelectorAll('.submenu').forEach(submenu => {
            if (submenu !== myTeamSubmenu) {
              submenu.classList.remove('active');
            }
          });
          document.querySelectorAll('.dropdown-icon').forEach(icon => {
            if (icon !== dropdownIcon) {
              icon.classList.remove('active');
            }
          });
        });

        const submenuLinks = myTeamSubmenu.querySelectorAll('a');
        submenuLinks.forEach(link => {
          link.addEventListener('click', () => {
            if (window.innerWidth <= 768) {
              sidebar.classList.remove('active');
            }
          });
        });

        document.addEventListener('click', (e) => {
          if (!myTeamToggle.contains(e.target) && !myTeamSubmenu.contains(e.target)) {
            myTeamSubmenu.classList.remove('active');
            dropdownIcon.classList.remove('active');
          }
        });
      }
    });
  </script>
</body>
</html>